EXPLICACI√ìN:
He creado lo siguiente
1. Pesta√±a "ü§ñ Modo Simulaci√≥n" (Demo)
Esta pesta√±a est√° dise√±ada para mostrarte c√≥mo funciona el algoritmo XGBoost sin necesidad de datos reales. Su principal funci√≥n es la demostraci√≥n y la prueba de la interfaz.

C√≥mo usarla:
Generar el Modelo:

Ver√°s un bot√≥n que dice "Generar Modelo de Simulaci√≥n".

Acci√≥n: Haz clic en este bot√≥n.

Resultado: El servidor de Streamlit generar√° 500 filas de datos sint√©ticos (inventados con la l√≥gica de que un suelo m√°s pobre necesita m√°s Biochar) y entrenar√° el modelo XGBoost con ellos. Ver√°s un mensaje verde de √©xito.

Interactuar con los Par√°metros:

Aparecer√°n dos deslizadores (sliders):

pH del Suelo: Mueve este control entre 4.0 (muy √°cido) y 9.0 (muy alcalino).

Materia Org√°nica (%): Mueve este control entre 1.0% y 5.0%. [Eleg√ç el rango $1.0\%-5.0\%$ para que el prototipo refleje las condiciones m√°s frecuentes de los suelos agr√≠colas y para prevenir errores de predicci√≥n por intentar extrapolar a condiciones extremas (como desiertos o turberas).]

Acci√≥n: Mueve ambos deslizadores lentamente.

Resultado: El valor en "Dosis Sugerida (Simulada)" cambiar√° inmediatamente.

Observaci√≥n Clave: Nota c√≥mo la dosis aumenta si el pH es bajo y la Materia Org√°nica es baja. Esto refleja la hip√≥tesis b√°sica que el modelo sint√©tico est√° aprendiendo.
NOTA Base Agron√≥mica (Rango T√≠pico)
El rango $1\%-5\%$ representa la mayor√≠a de los suelos agr√≠colas de labranza media a alta en climas templados y tropicales, que son los que t√≠picamente se buscan mejorar con biocarb√≥n.Menos de $1\%$: Se considera un suelo muy pobre, t√≠picamente arenoso o muy degradado. Aunque existen, no son el rango central de la agricultura productiva.M√°s de $5\%$: Estos son suelos con un contenido org√°nico excepcionalmente alto, como los suelos de turba o Mollisoles (suelos oscuros y ricos). En estos casos, la necesidad de agregar enmiendas como el biocarb√≥n para mejorar la fertilidad suele ser menor.Establecer un rango central y realista como $1.0\%-5.0\%$ garantiza que el modelo sint√©tico se centre en el escenario m√°s com√∫n de toma de decisiones en la agricultura.
Es fundamental entender los rangos de entrada para que el modelo sea realista.La raz√≥n por la que en el Modo Simulaci√≥n establecimos el rango de la Materia Org√°nica (MO) entre $1.0\%$ y $5.0\%$ tiene tres bases principales: ecol√≥gica, agron√≥mica y de modelado.1. Base Agron√≥mica (Rango T√≠pico). El rango $1\%-5\%$ representa la mayor√≠a de los suelos agr√≠colas de labranza media a alta en climas templados y tropicales, que son los que t√≠picamente se buscan mejorar con biocarb√≥n.Menos de $1\%$: Se considera un suelo muy pobre, t√≠picamente arenoso o muy degradado. Aunque existen, no son el rango central de la agricultura productiva.M√°s de $5\%$: Estos son suelos con un contenido org√°nico excepcionalmente alto, como los suelos de turba o Mollisoles (suelos oscuros y ricos). En estos casos, la necesidad de agregar enmiendas como el biocarb√≥n para mejorar la fertilidad suele ser menor.Establecer un rango central y realista como $1.0\%-5.0\%$ garantiza que el modelo sint√©tico se centre en el escenario m√°s com√∫n de toma de decisiones en la agricultura.2. Base del Modelado (Evitar Extrapolaci√≥n Extrema). En el aprendizaje autom√°tico, especialmente cuando se trabaja con datos sint√©ticos o limitados (como en la Pesta√±a 2 cuando subas pocos datos), es crucial evitar que el usuario ingrese valores que el modelo nunca ha visto o que se encuentran muy lejos del rango de entrenamiento.

Riesgo de Extrapolaci√≥n: Si el modelo solo ha sido entrenado con datos entre $1\%$ y $5\%$, y un usuario ingresa $15\%$ (un valor de turbera), la predicci√≥n de la dosis de Biochar ser√° una extrapolaci√≥n y es probable que sea muy inexacta o incluso rid√≠cula.Prop√≥sito del Slider: El deslizador restringe la entrada a un dominio razonable para proteger al modelo y al usuario de obtener resultados sin sentido.

Conexi√≥n con el Concepto de Biochar:
El biocarb√≥n se utiliza principalmente en suelos que presentan alg√∫n tipo de limitaci√≥n. Si un suelo tiene un $1.0\%$ de MO, es un suelo con baja capacidad de retenci√≥n de agua y nutrientes, por lo que la adici√≥n de Biochar es muy relevante.Si un suelo tiene un $5.0\%$ de MO, sus propiedades f√≠sicas y qu√≠micas ya son muy buenas. Aunque el Biochar puede mejorar aspectos como la adsorci√≥n de metales pesados, la necesidad de agregar grandes cantidades para mejorar la fertilidad general disminuye.

Nota:
En varios casos los autores reportan carbono org√°nico (SOC, %) y no directamente ‚Äú% MO‚Äù; para homogenizar la tabla convert√≠ SOC‚ÜíMO usando el factor de Van Bemmelen (MO ‚âà SOC√ó1,724). Cuando la dosis est√° en % (w/w) la he extrapolado a t/ha asumiendo 0‚Äì20 cm de suelo y densidad aparente 1,3 t/m¬≥, dejando claro que es una equivalencia de laboratorio a campo, no una recomendaci√≥n directa.

2. Pesta√±a "üìÇ Carga tus Datos Reales" (Uso Cient√≠fico)

Los datos para entrenar el modelo muestran claramente la relaci√≥n entre las caracter√≠sticas del suelo (pH y MO) y las dosis efectivas de biochar. Se observa que:

En suelos √°cidos (pH < 6.0) con baja MO (< 2.0%) se requieren dosis m√°s altas (20-35 Ton/Ha)

En suelos con MO > 4.0% las dosis efectivas son significativamente menores (5-8 Ton/Ha)

Las aplicaciones espec√≠ficas para remediaci√≥n de metales pesados generalmente requieren dosis intermedias (15-25 Ton/Ha)

Los suelos alcalinos (pH > 7.5) muestran respuestas efectivas con dosis moderadas (10-20 Ton/Ha)

Con la primera carga de informaci√≥n el Modelo debi√≥ aprender:
Condiciones Extremas (Dosis Alta): El modelo aprende que para suelos con pH bajo (4.2 - 4.9) y/o Materia Org√°nica baja (0.8% - 1.5%), se necesitan dosis de Biochar significativamente m√°s altas ($22$ a $35$ t/ha) para lograr una rehabilitaci√≥n.Condiciones √ìptimas (Dosis Baja): Aprender√° que para suelos con pH neutro a alcalino (6.9 - 8.1) y Materia Org√°nica alta (3.5% - 5.2%), la dosis de Biochar es menor ($5$ a $12$ t/ha).
--------------------------------------------------------------
Esta es la pesta√±a crucial que convierte la demo en una herramienta cient√≠fica real para mi trabajo de investigaci√≥n. Aqu√≠ es donde le entrego los resultados de referenciapara que XGBoost aprenda patrones √∫nicos.

Requisito: El Archivo CSV
Antes de usar esta pesta√±a, necesitas tener un archivo de datos. Crea una hoja de c√°lculo (Excel, Google Sheets, etc.) con los siguientes tres encabezados (columnas) y guarda el archivo en formato CSV (Valores Separados por Coma):
ph: El pH medido del suelo.

mo: El porcentaje de materia org√°nica del suelo.

dosis_efectiva: La cantidad de Biochar (en Ton/Ha) que se us√≥ en ese experimento y que result√≥ en el mejoramiento que buscas (p. ej., m√°xima fertilidad o m√°xima adsorci√≥n, seg√∫n el objetivo de tu estudio).

C√≥mo usarla:
Subir el Archivo:

Haz clic en el bot√≥n "Sube tu archivo CSV".

Acci√≥n: Sube el archivo CSV que contiene tus datos reales de suelo.

Entrenar el Modelo:

Haz clic en el bot√≥n "Entrenar XGBoost con mis datos".

Acci√≥n: El servidor lee tus datos, los divide y entrena un nuevo modelo XGBoost √∫nico para tus condiciones.

Resultado: Ver√°s un mensaje de √©xito con un valor de Precisi√≥n (R2). Cuanto m√°s cerca est√© este n√∫mero de 1.0, mejor ha aprendido el modelo tus datos.

Hacer Predicciones Reales:

Una vez entrenado, aparecer√°n dos cuadros de entrada: "Ingresa pH real" e "Ingresa MO real".

Acci√≥n: Introduce los valores actuales del suelo que deseas mejorar.

Resultado: Haz clic en "Calcular (Modelo Real)" y obtendr√°s la dosis de Biochar recomendada, basada enteramente en la experiencia hist√≥rica de tus propios datos.


import streamlit as st
import pandas as pd
import xgboost as xgb
import numpy as np

# Configuraci√≥n
st.set_page_config(page_title="Calculadora Biochar", layout="wide")

st.title("üß™ Prototipo: IA para Dosis de Biochar")
st.markdown("""
Esta aplicaci√≥n demuestra el uso del algoritmo **XGBoost** (usado en *Scientific Reports, 2025*) 
para predecir la dosis de Biochar.
""")

# Creamos pesta√±as
tab1, tab2 = st.tabs(["ü§ñ Modo Simulaci√≥n", "üìÇ Carga tus Datos Reales"])

# --- PESTA√ëA 1: SIMULACI√ìN ---
with tab1:
    st.warning("‚ö†Ô∏è **AVISO:** Este modo utiliza datos sint√©ticos para demostrar la interfaz.")
    
    # Modelo para Simulaci√≥n
    @st.cache_resource
    def entrenar_modelo_simulado():
        np.random.seed(42)
        n = 500
        ph = np.random.uniform(4, 9, n)
        mo = np.random.uniform(1, 5, n)
        dosis = (9 - ph) * 2 + (6 - mo) + np.random.normal(0, 0.2, n)
        df_sim = pd.DataFrame({'pH': ph, 'MO': mo, 'Dosis': dosis})
        model_sim = xgb.XGBRegressor(objective='reg:squarederror')
        model_sim.fit(df_sim[['pH', 'MO']], df_sim['Dosis'])
        return model_sim

    if st.button("Generar Modelo de Simulaci√≥n"):
        model_sim = entrenar_modelo_simulado()
        st.session_state['model_sim'] = model_sim
        st.success("Modelo simulado entrenado exitosamente. Ahora puedes ajustar los par√°metros.")

    if 'model_sim' in st.session_state:
        model_sim = st.session_state['model_sim']
        st.divider()
        st.subheader("Simulaci√≥n en Tiempo Real")
        col1, col2 = st.columns(2)
        with col1:
            val_ph = st.slider("pH del Suelo", 4.0, 9.0, 6.5)
        with col2:
            val_mo = st.slider("Materia Org√°nica (%)", 1.0, 5.0, 2.5)
            
        pred = model_sim.predict(pd.DataFrame([[val_ph, val_mo]], columns=['pH', 'MO']))[0]
        st.metric(label="Dosis Sugerida (Simulada)", value=f"{pred:.2f} Ton/Ha")

# --- PESTA√ëA 2: CARGA DE DATOS REALES ---
with tab2:
    st.header("Entrena con tus datos de laboratorio")
    st.info("Sube un archivo CSV con columnas: 'ph', 'mo', 'dosis_efectiva'")
    
    uploaded_file = st.file_uploader("Sube tu archivo CSV", type=["csv"])
    
    if uploaded_file is not None:
        df_real = pd.read_csv(uploaded_file)
        
        if st.button("Entrenar XGBoost con mis datos"):
            try:
                # Asumimos que las columnas son 'ph', 'mo', 'dosis_efectiva'
                X = df_real[['ph', 'mo']]
                y = df_real['dosis_efectiva']
                
                model_real = xgb.XGBRegressor(n_estimators=100, learning_rate=0.1)
                model_real.fit(X, y)
                score = model_real.score(X, y)
                
                st.session_state['model_real'] = model_real
                st.success(f"¬°Modelo entrenado con TUS datos! Precisi√≥n (R2): {score:.4f}")
                
            except KeyError:
                st.error("Error: Aseg√∫rate de que tu archivo CSV contenga las columnas 'ph', 'mo', y 'dosis_efectiva'.")
            except Exception as e:
                st.error(f"Error desconocido durante el entrenamiento: {e}")
                
    if 'model_real' in st.session_state:
        st.divider()
        st.subheader("Calculadora basada en TUS datos")
        r_ph = st.number_input("Ingresa pH real", value=6.0)
        r_mo = st.number_input("Ingresa MO real", value=2.0)
        
        if st.button("Calcular (Modelo Real)"):
            pred_real = st.session_state['model_real'].predict(pd.DataFrame([[r_ph, r_mo]], columns=['ph', 'mo']))[0]

            st.success(f"Dosis calculada: {pred_real:.2f} Ton/Ha")



