EXPLICACI칍N:
He creado lo siguiente
1. Pesta침a "游뱄 Modo Simulaci칩n" (Demo)
Esta pesta침a est치 dise침ada para mostrarte c칩mo funciona el algoritmo XGBoost sin necesidad de datos reales. Su principal funci칩n es la demostraci칩n y la prueba de la interfaz.

C칩mo usarla:
Generar el Modelo:

Ver치s un bot칩n que dice "Generar Modelo de Simulaci칩n".

Acci칩n: Haz clic en este bot칩n.

Resultado: El servidor de Streamlit generar치 500 filas de datos sint칠ticos (inventados con la l칩gica de que un suelo m치s pobre necesita m치s Biochar) y entrenar치 el modelo XGBoost con ellos. Ver치s un mensaje verde de 칠xito.

Interactuar con los Par치metros:

Aparecer치n dos deslizadores (sliders):

pH del Suelo: Mueve este control entre 4.0 (muy 치cido) y 9.0 (muy alcalino).

Materia Org치nica (%): Mueve este control entre 1.0% y 5.0%.

Acci칩n: Mueve ambos deslizadores lentamente.

Resultado: El valor en "Dosis Sugerida (Simulada)" cambiar치 inmediatamente.

Observaci칩n Clave: Nota c칩mo la dosis aumenta si el pH es bajo y la Materia Org치nica es baja. Esto refleja la hip칩tesis b치sica que el modelo sint칠tico est치 aprendiendo.

2. Pesta침a "游늭 Carga tus Datos Reales" (Uso Cient칤fico)
Esta es la pesta침a crucial que convierte la demo en una herramienta cient칤fica real para tu investigaci칩n. Aqu칤 es donde le entregas los resultados de tus experimentos para que XGBoost aprenda tus patrones 칰nicos.

Requisito: El Archivo CSV
Antes de usar esta pesta침a, necesitas tener un archivo de datos. Crea una hoja de c치lculo (Excel, Google Sheets, etc.) con los siguientes tres encabezados (columnas) y guarda el archivo en formato CSV (Valores Separados por Coma):
ph: El pH medido del suelo.

mo: El porcentaje de materia org치nica del suelo.

dosis_efectiva: La cantidad de Biochar (en Ton/Ha) que se us칩 en ese experimento y que result칩 en el mejoramiento que buscas (p. ej., m치xima fertilidad o m치xima adsorci칩n, seg칰n el objetivo de tu estudio).

C칩mo usarla:
Subir el Archivo:

Haz clic en el bot칩n "Sube tu archivo CSV".

Acci칩n: Sube el archivo CSV que contiene tus datos reales de suelo.

Entrenar el Modelo:

Haz clic en el bot칩n "Entrenar XGBoost con mis datos".

Acci칩n: El servidor lee tus datos, los divide y entrena un nuevo modelo XGBoost 칰nico para tus condiciones.

Resultado: Ver치s un mensaje de 칠xito con un valor de Precisi칩n (R2). Cuanto m치s cerca est칠 este n칰mero de 1.0, mejor ha aprendido el modelo tus datos.

Hacer Predicciones Reales:

Una vez entrenado, aparecer치n dos cuadros de entrada: "Ingresa pH real" e "Ingresa MO real".

Acci칩n: Introduce los valores actuales del suelo que deseas mejorar.

Resultado: Haz clic en "Calcular (Modelo Real)" y obtendr치s la dosis de Biochar recomendada, basada enteramente en la experiencia hist칩rica de tus propios datos.


import streamlit as st
import pandas as pd
import xgboost as xgb
import numpy as np

# Configuraci칩n
st.set_page_config(page_title="Calculadora Biochar", layout="wide")

st.title("游빍 Prototipo: IA para Dosis de Biochar")
st.markdown("""
Esta aplicaci칩n demuestra el uso del algoritmo **XGBoost** (usado en *Scientific Reports, 2025*) 
para predecir la dosis de Biochar.
""")

# Creamos pesta침as
tab1, tab2 = st.tabs(["游뱄 Modo Simulaci칩n", "游늭 Carga tus Datos Reales"])

# --- PESTA칌A 1: SIMULACI칍N ---
with tab1:
    st.warning("丘멆잺 **AVISO:** Este modo utiliza datos sint칠ticos para demostrar la interfaz.")
    
    # Modelo para Simulaci칩n
    @st.cache_resource
    def entrenar_modelo_simulado():
        np.random.seed(42)
        n = 500
        ph = np.random.uniform(4, 9, n)
        mo = np.random.uniform(1, 5, n)
        dosis = (9 - ph) * 2 + (6 - mo) + np.random.normal(0, 0.2, n)
        df_sim = pd.DataFrame({'pH': ph, 'MO': mo, 'Dosis': dosis})
        model_sim = xgb.XGBRegressor(objective='reg:squarederror')
        model_sim.fit(df_sim[['pH', 'MO']], df_sim['Dosis'])
        return model_sim

    if st.button("Generar Modelo de Simulaci칩n"):
        model_sim = entrenar_modelo_simulado()
        st.session_state['model_sim'] = model_sim
        st.success("Modelo simulado entrenado exitosamente. Ahora puedes ajustar los par치metros.")

    if 'model_sim' in st.session_state:
        model_sim = st.session_state['model_sim']
        st.divider()
        st.subheader("Simulaci칩n en Tiempo Real")
        col1, col2 = st.columns(2)
        with col1:
            val_ph = st.slider("pH del Suelo", 4.0, 9.0, 6.5)
        with col2:
            val_mo = st.slider("Materia Org치nica (%)", 1.0, 5.0, 2.5)
            
        pred = model_sim.predict(pd.DataFrame([[val_ph, val_mo]], columns=['pH', 'MO']))[0]
        st.metric(label="Dosis Sugerida (Simulada)", value=f"{pred:.2f} Ton/Ha")

# --- PESTA칌A 2: CARGA DE DATOS REALES ---
with tab2:
    st.header("Entrena con tus datos de laboratorio")
    st.info("Sube un archivo CSV con columnas: 'ph', 'mo', 'dosis_efectiva'")
    
    uploaded_file = st.file_uploader("Sube tu archivo CSV", type=["csv"])
    
    if uploaded_file is not None:
        df_real = pd.read_csv(uploaded_file)
        
        if st.button("Entrenar XGBoost con mis datos"):
            try:
                # Asumimos que las columnas son 'ph', 'mo', 'dosis_efectiva'
                X = df_real[['ph', 'mo']]
                y = df_real['dosis_efectiva']
                
                model_real = xgb.XGBRegressor(n_estimators=100, learning_rate=0.1)
                model_real.fit(X, y)
                score = model_real.score(X, y)
                
                st.session_state['model_real'] = model_real
                st.success(f"춰Modelo entrenado con TUS datos! Precisi칩n (R2): {score:.4f}")
                
            except KeyError:
                st.error("Error: Aseg칰rate de que tu archivo CSV contenga las columnas 'ph', 'mo', y 'dosis_efectiva'.")
            except Exception as e:
                st.error(f"Error desconocido durante el entrenamiento: {e}")
                
    if 'model_real' in st.session_state:
        st.divider()
        st.subheader("Calculadora basada en TUS datos")
        r_ph = st.number_input("Ingresa pH real", value=6.0)
        r_mo = st.number_input("Ingresa MO real", value=2.0)
        
        if st.button("Calcular (Modelo Real)"):
            pred_real = st.session_state['model_real'].predict(pd.DataFrame([[r_ph, r_mo]], columns=['ph', 'mo']))[0]

            st.success(f"Dosis calculada: {pred_real:.2f} Ton/Ha")
